<!doctype html>
<html lang="zh-TW">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>ç­ç´šäº¤æ›æŠ½ç±¤å·¥å…·</title>
 <style>
   body {
     box-sizing: border-box;
     margin: 0;
     padding: 0;
     font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
     background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
     min-height: 100%;
     overflow-x: hidden;
   }
   
   * {
     box-sizing: border-box;
   }
   
   .container {
     max-width: 1400px;
     margin: 0 auto;
     padding: 2rem;
   }
   
   .header {
     text-align: center;
     margin-bottom: 2rem;
     animation: fadeInDown 0.8s ease-out;
   }
   
   .header h1 {
     color: #ffffff;
     font-size: 3rem;
     margin: 0 0 1rem 0;
     text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
   }
   
   .header p {
     color: #e0e7ff;
     font-size: 1.2rem;
     margin: 0;
   }
   
   .logo-container {
     display: flex;
     justify-content: center;
     margin-bottom: 2rem;
   }
   
   .logo {
     width: 100px;
     height: 100px;
     animation: float 3s ease-in-out infinite;
   }
   
   .control-panel {
     background: white;
     border-radius: 20px;
     padding: 2rem;
     margin-bottom: 2rem;
     box-shadow: 0 10px 30px rgba(0,0,0,0.2);
     animation: fadeInUp 0.8s ease-out;
   }
   
   .settings-group {
     display: flex;
     gap: 2rem;
     justify-content: center;
     margin-bottom: 2rem;
     flex-wrap: wrap;
   }
   
   .setting-item {
     flex: 1;
     min-width: 200px;
     max-width: 300px;
   }
   
   .setting-item label {
     display: block;
     margin-bottom: 0.5rem;
     color: #4a5568;
     font-weight: 600;
     font-size: 1rem;
   }
   
   .select-input, .number-input {
     width: 100%;
     padding: 0.75rem 1rem;
     border: 2px solid #e2e8f0;
     border-radius: 10px;
     font-size: 1.1rem;
     font-weight: 600;
     color: #2d3748;
     background: white;
     transition: all 0.3s ease;
     cursor: pointer;
   }
   
   .select-input:focus, .number-input:focus {
     outline: none;
     border-color: #667eea;
     box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
   }
   
   .number-input {
     text-align: center;
   }
   
   .action-buttons {
     display: flex;
     gap: 1rem;
     justify-content: center;
   }
   
   .btn {
     padding: 1rem 2.5rem;
     border: none;
     border-radius: 12px;
     font-size: 1.2rem;
     font-weight: 600;
     cursor: pointer;
     transition: all 0.3s ease;
     display: flex;
     align-items: center;
     justify-content: center;
     gap: 0.5rem;
   }
   
   .btn-primary {
     background: linear-gradient(135deg, #10b981 0%, #059669 100%);
     color: white;
     box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
   }
   
   .btn-primary:hover {
     transform: translateY(-2px);
     box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
   }
   
   .btn-secondary {
     background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
     color: white;
     box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
   }
   
   .btn-secondary:hover {
     transform: translateY(-2px);
     box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5);
   }
   
   .btn:disabled {
     opacity: 0.5;
     cursor: not-allowed;
     transform: none !important;
   }
   
   .classes-grid {
     background: white;
     border-radius: 20px;
     padding: 2rem;
     box-shadow: 0 10px 30px rgba(0,0,0,0.2);
     animation: fadeInUp 0.8s ease-out 0.2s both;
   }
   
   .grid-header {
     text-align: center;
     margin-bottom: 2rem;
     padding-bottom: 1rem;
     border-bottom: 2px solid #e2e8f0;
   }
   
   .grid-header h2 {
     color: #2d3748;
     margin: 0 0 0.5rem 0;
     font-size: 1.8rem;
   }
   
   .grid-subtitle {
     color: #718096;
     font-size: 1rem;
   }
   
   .class-grid {
     display: grid;
     grid-template-columns: repeat(4, 1fr);
     grid-template-rows: repeat(5, auto);
     grid-auto-flow: column;
     gap: 1rem;
     margin-bottom: 2rem;
   }
   
   .class-card {
     background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
     border-radius: 12px;
     padding: 1.5rem;
     text-align: center;
     transition: all 0.3s ease;
     border: 3px solid transparent;
     position: relative;
     overflow: hidden;
   }
   
   .class-card::before {
     content: '';
     position: absolute;
     top: 0;
     left: 0;
     right: 0;
     height: 4px;
     background: linear-gradient(90deg, #667eea, #764ba2);
   }
   
   .class-card.swapped {
     animation: highlight 1s ease-out;
     border-color: #10b981;
   }
   
   .position-number {
     font-size: 0.9rem;
     color: #a0aec0;
     font-weight: 600;
     margin-bottom: 0.5rem;
   }
   
   .class-number {
     font-size: 2.5rem;
     font-weight: 700;
     color: #2d3748;
     margin: 0.5rem 0;
   }
   
   .arrow-indicator {
     font-size: 1.2rem;
     color: #10b981;
     margin: 0.25rem 0;
     opacity: 0;
     transition: opacity 0.3s ease;
   }
   
   .class-card.swapped .arrow-indicator {
     opacity: 1;
   }
   
   .original-class {
     font-size: 0.85rem;
     color: #718096;
     font-weight: 500;
   }
   
   .history-section {
     background: white;
     border-radius: 20px;
     padding: 2rem;
     margin-top: 2rem;
     box-shadow: 0 10px 30px rgba(0,0,0,0.2);
     animation: fadeInUp 0.8s ease-out 0.4s both;
   }
   
   .history-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin-bottom: 1.5rem;
     padding-bottom: 1rem;
     border-bottom: 2px solid #e2e8f0;
   }
   
   .history-header h3 {
     color: #2d3748;
     margin: 0;
     font-size: 1.5rem;
   }
   
   .history-count {
     background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
     color: white;
     padding: 0.5rem 1rem;
     border-radius: 20px;
     font-weight: 600;
     font-size: 0.9rem;
   }
   
   .history-list {
     max-height: 500px;
     overflow-y: auto;
   }
   
   .history-item {
     background: #f7fafc;
     border-radius: 12px;
     margin-bottom: 1.5rem;
     overflow: hidden;
     border: 2px solid #e2e8f0;
   }
   
   .history-item-header {
     background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
     color: white;
     padding: 0.75rem 1rem;
     display: flex;
     justify-content: space-between;
     align-items: center;
     font-weight: 600;
   }
   
   .history-time {
     color: #e0e7ff;
     font-size: 0.85rem;
   }
   
   .history-table-container {
     padding: 1rem;
     overflow-x: auto;
   }
   
   .history-table {
     width: 100%;
     border-collapse: collapse;
     font-size: 0.9rem;
   }
   
   .history-table thead {
     background: #edf2f7;
   }
   
   .history-table th {
     padding: 0.75rem 0.5rem;
     text-align: center;
     font-weight: 600;
     color: #4a5568;
     border-bottom: 2px solid #cbd5e0;
   }
   
   .history-table td {
     padding: 0.6rem 0.5rem;
     text-align: center;
     border-bottom: 1px solid #e2e8f0;
     color: #2d3748;
   }
   
   .history-table tbody tr:hover {
     background: #f7fafc;
   }
   
   .history-table tbody tr:last-child td {
     border-bottom: none;
   }
   
   .arrow-cell {
     color: #10b981;
     font-weight: 700;
     font-size: 1.1rem;
   }
   
   .class-cell {
     font-weight: 600;
     font-size: 1rem;
   }
   
   .position-cell {
     color: #718096;
     font-weight: 500;
   }
   
   .empty-history {
     text-align: center;
     padding: 2rem;
     color: #a0aec0;
   }
   
   .loading {
     display: inline-block;
     width: 20px;
     height: 20px;
     border: 3px solid rgba(255,255,255,0.3);
     border-radius: 50%;
     border-top-color: white;
     animation: spin 0.8s linear infinite;
   }
   
   .toast {
     position: fixed;
     top: 20px;
     right: 20px;
     padding: 1rem 1.5rem;
     border-radius: 10px;
     box-shadow: 0 4px 12px rgba(0,0,0,0.3);
     z-index: 1000;
     font-weight: 600;
     animation: slideInRight 0.3s ease-out;
   }
   
   .toast.success {
     background: #10b981;
     color: white;
   }
   
   .toast.error {
     background: #ef4444;
     color: white;
   }
   
   @keyframes fadeInDown {
     from {
       opacity: 0;
       transform: translateY(-30px);
     }
     to {
       opacity: 1;
       transform: translateY(0);
     }
   }
   
   @keyframes fadeInUp {
     from {
       opacity: 0;
       transform: translateY(30px);
     }
     to {
       opacity: 1;
       transform: translateY(0);
     }
   }
   
   @keyframes float {
     0%, 100% {
       transform: translateY(0);
     }
     50% {
       transform: translateY(-20px);
     }
   }
   
   @keyframes spin {
     to {
       transform: rotate(360deg);
     }
   }
   
   @keyframes highlight {
     0%, 100% {
       background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
     }
     50% {
       background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
     }
   }
   
   @keyframes slideInRight {
     from {
       transform: translateX(400px);
       opacity: 0;
     }
     to {
       transform: translateX(0);
       opacity: 1;
     }
   }
   
   @media (max-width: 1200px) {
     .class-grid {
       grid-template-columns: repeat(3, 1fr);
     }
   }
   
   @media (max-width: 768px) {
     .header h1 {
       font-size: 2rem;
     }
     
     .class-grid {
       grid-template-columns: repeat(2, 1fr);
     }
     
     .settings-group {
       flex-direction: column;
     }
     
     .setting-item {
       max-width: 100%;
     }
     
     .action-buttons {
       flex-direction: column;
     }
     
     .btn {
       width: 100%;
     }
     
     .history-table {
       font-size: 0.8rem;
     }
     
     .history-table th,
     .history-table td {
       padding: 0.5rem 0.25rem;
     }
   }
 </style>
 <style>@view-transition { navigation: auto; }</style>
 <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
 <main class="container">
   <header class="header">
     <div class="logo-container">
       <svg class="logo" viewbox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs>
         <lineargradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
           <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
           <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
         </lineargradient>
       </defs> <circle cx="60" cy="60" r="55" fill="white" opacity="0.2" /> <rect x="25" y="35" width="30" height="40" rx="5" fill="url(#grad1)" transform="rotate(-15 40 55)">
         <animatetransform attributename="transform" type="rotate" from="-15 40 55" to="15 40 55" dur="2s" repeatcount="indefinite" direction="alternate" />
       </rect> <rect x="65" y="35" width="30" height="40" rx="5" fill="#10b981" transform="rotate(15 80 55)">
         <animatetransform attributename="transform" type="rotate" from="15 80 55" to="-15 80 55" dur="2s" repeatcount="indefinite" direction="alternate" />
       </rect> <path d="M 45 55 Q 60 45 75 55" stroke="white" stroke-width="3" fill="none" stroke-linecap="round">
         <animate attributename="d" from="M 45 55 Q 60 45 75 55" to="M 45 55 Q 60 65 75 55" dur="2s" repeatcount="indefinite" direction="alternate" />
       </path>
       </svg>
     </div>
     <h1 id="main-title">ç­ç´šäº¤æ›æŠ½ç±¤å·¥å…·</h1>
     <p id="subtitle">éš¨æ©Ÿå°èª¿ç­ç´šä½ç½®</p>
   </header>
   <section class="control-panel">
     <div class="settings-group">
       <div class="setting-item"><label for="grade-select">é¸æ“‡å¹´ç´š</label> <select id="grade-select" class="select-input"> <option value="7">ä¸ƒå¹´ç´š</option> <option value="8">å…«å¹´ç´š</option> <option value="9">ä¹å¹´ç´š</option> </select>
       </div>
       <div class="setting-item"><label for="class-count">ç­ç´šæ•¸é‡</label> <input type="number" id="class-count" class="number-input" min="1" max="20" value="20">
       </div>
     </div>
     <div class="action-buttons"><button class="btn btn-primary" id="shuffle-btn"> <span>ğŸ²</span> <span id="shuffle-btn-text">é–‹å§‹éš¨æ©Ÿå°èª¿</span> </button> <button class="btn btn-secondary" id="reset-btn"> <span>ğŸ”„</span> <span id="reset-btn-text">æ¢å¾©åŸå§‹é †åº</span> </button>
     </div>
   </section>
   <section class="classes-grid">
     <div class="grid-header">
       <h2>ç­ç´šä½ç½®</h2>
       <p class="grid-subtitle" id="grid-subtitle">ç›®å‰å…± 20 å€‹ç­ç´š</p>
     </div>
     <div class="class-grid" id="class-grid"></div>
   </section>
   <section class="history-section">
     <div class="history-header">
       <h3>å°èª¿è¨˜éŒ„</h3>
       <div class="history-count" id="history-count">
       å…± 0 æ¬¡
       </div>
     </div>
     <div class="history-list" id="history-list">
       <div class="empty-history">
       å°šç„¡å°èª¿è¨˜éŒ„
       </div>
     </div>
   </section>
 </main>
 <script>
   const defaultConfig = {
     main_title: 'ç­ç´šäº¤æ›æŠ½ç±¤å·¥å…·',
     subtitle: 'éš¨æ©Ÿå°èª¿ç­ç´šä½ç½®',
     shuffle_button_text: 'é–‹å§‹éš¨æ©Ÿå°èª¿',
     reset_button_text: 'æ¢å¾©åŸå§‹é †åº',
     background_color: '#667eea',
     surface_color: '#ffffff',
     text_color: '#2d3748',
     primary_action_color: '#10b981',
     secondary_action_color: '#f59e0b',
     font_family: 'Microsoft JhengHei',
     font_size: 16
   };

   let currentGrade = 7;
   let currentClassCount = 20;
   let originalClasses = [];
   let currentClasses = [];
   let allRecords = [];

   function generateClasses(grade, count) {
     const classes = [];
     for (let i = 1; i <= count; i++) {
       classes.push(`${grade}${String(i).padStart(2, '0')}`);
     }
     return classes;
   }

   function updateClasses() {
     originalClasses = generateClasses(currentGrade, currentClassCount);
     currentClasses = [...originalClasses];
   }

   function renderClassGrid() {
     const grid = document.getElementById('class-grid');
     const subtitle = document.getElementById('grid-subtitle');
     grid.innerHTML = '';
     
     const gradeText = currentGrade === 7 ? 'ä¸ƒå¹´ç´š' : currentGrade === 8 ? 'å…«å¹´ç´š' : 'ä¹å¹´ç´š';
     subtitle.textContent = `${gradeText} - å…± ${currentClassCount} å€‹ç­ç´š`;
     
     currentClasses.forEach((className, index) => {
       const card = document.createElement('div');
       card.className = 'class-card';
       card.id = `class-${index}`;
       
       const isSwapped = className !== originalClasses[index];
       if (isSwapped) {
         card.classList.add('swapped');
       }
       
       card.innerHTML = `
         <div class="position-number">ä½ç½® ${index + 1}</div>
         <div class="class-number">${className}</div>
         ${isSwapped ? `
           <div class="arrow-indicator">â†‘</div>
           <div class="original-class">åŸ: ${originalClasses[index]}</div>
         ` : ''}
       `;
       
       grid.appendChild(card);
     });
   }

   function shuffleArray(array) {
     const n = array.length;
     const newArray = [...array];
     let attempts = 0;
     const maxAttempts = 1000;
     
     while (attempts < maxAttempts) {
       for (let i = n - 1; i > 0; i--) {
         const j = Math.floor(Math.random() * (i + 1));
         [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
       }
       
       let allMoved = true;
       for (let i = 0; i < n; i++) {
         if (newArray[i] === array[i]) {
           allMoved = false;
           break;
         }
       }
       
       if (allMoved) {
         return newArray;
       }
       
       attempts++;
     }
     
     // Fallback: If a perfect derangement isn't found, just shift the array
     for (let i = 0; i < n; i++) {
       newArray[i] = array[(i + 1) % n];
     }
     
     return newArray;
   }

   async function handleShuffle() {
     if (allRecords.length >= 999) {
       showToast('å·²é”åˆ°è¨˜éŒ„ä¸Šé™ (999 ç­†)ï¼Œè«‹å…ˆæ¸…é™¤éƒ¨åˆ†è¨˜éŒ„', 'error');
       return;
     }

     const shuffleBtn = document.getElementById('shuffle-btn');
     shuffleBtn.disabled = true;
     shuffleBtn.innerHTML = '<span class="loading"></span><span>å°èª¿ä¸­...</span>';
     
     currentClasses = shuffleArray(currentClasses);
     
     const swaps = [];
     currentClasses.forEach((className, index) => {
       swaps.push(`${index + 1}|${originalClasses[index]}|${className}`);
     });
     
     const gradeText = currentGrade === 7 ? 'ä¸ƒå¹´ç´š' : currentGrade === 8 ? 'å…«å¹´ç´š' : 'ä¹å¹´ç´š';
     
     const record = {
       id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
       grade: gradeText,
       class_count: currentClassCount,
       shuffle_history: swaps.join(';;'),
       timestamp: new Date().toISOString()
     };
     
     // --- ä¿®æ”¹ï¼šä½¿ç”¨ localStorage å„²å­˜ ---
     try {
       allRecords.push(record);
       localStorage.setItem('shuffleHistory', JSON.stringify(allRecords));
       
       renderHistory(allRecords); // æ‰‹å‹•è§¸ç™¼æ­·å²ç´€éŒ„æ›´æ–°
       renderClassGrid();
       showToast(`æˆåŠŸå°èª¿ ${currentClassCount} å€‹ç­ç´šä½ç½®`, 'success');
     } catch (e) {
       console.error('å„²å­˜å¤±æ•—:', e);
       showToast('å°èª¿å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
       allRecords.pop(); // å„²å­˜å¤±æ•—ï¼Œç§»é™¤å‰›å‰›åŠ å…¥çš„ç´€éŒ„
     }
     // --- ä¿®æ”¹çµæŸ ---
     
     shuffleBtn.disabled = false;
     shuffleBtn.innerHTML = `<span>ğŸ²</span><span id="shuffle-btn-text">${defaultConfig.shuffle_button_text}</span>`;
   }

   function handleReset() {
     currentClasses = [...originalClasses];
     renderClassGrid();
     showToast('å·²æ¢å¾©åŸå§‹é †åº', 'success');
   }

   function renderHistory(data) {
     allRecords = data; // åŒæ­¥å…¨åŸŸè®Šæ•¸
     const historyList = document.getElementById('history-list');
     const historyCount = document.getElementById('history-count');
     
     historyCount.textContent = `å…± ${data.length} æ¬¡`;
     
     if (data.length === 0) {
       historyList.innerHTML = '<div class="empty-history">å°šç„¡å°èª¿è¨˜éŒ„</div>';
       return;
     }
     
     const sortedData = [...data].sort((a, b) => 
       new Date(b.timestamp) - new Date(a.timestamp)
     );
     
     historyList.innerHTML = sortedData.map(record => {
       const date = new Date(record.timestamp);
       const timeStr = date.toLocaleString('zh-TW', {
         year: 'numeric',
         month: '2-digit',
         day: '2-digit',
         hour: '2-digit',
         minute: '2-digit'
       });
       
       const swaps = record.shuffle_history.split(';;');
       const tableRows = swaps.map(swap => {
         const [position, original, newClass] = swap.split('|');
         return `
           <tr>
             <td class="position-cell">ä½ç½® ${position}</td>
             <td class="class-cell">${original}</td>
             <td class="arrow-cell">â†’</td>
             <td class="class-cell">${newClass}</td>
           </tr>
         `;
       }).join('');
       
       return `
         <div class="history-item">
           <div class="history-item-header">
             <span><strong>${record.grade || 'ä¸ƒå¹´ç´š'}</strong> (${record.class_count || 20}ç­)</span>
             <span class="history-time">${timeStr}</span>
           </div>
           <div class="history-table-container">
             <table class="history-table">
               <thead>
                 <tr>
                   <th>ä½ç½®</th>
                   <th>åŸç­ç´š</th>
                   <th></th>
                   <th>æ–°ç­ç´š</th>
                 </tr>
               </thead>
               <tbody>
                 ${tableRows}
               </tbody>
             </table>
           </div>
         </div>
       `;
     }).join('');
   }

   function showToast(message, type) {
     const toast = document.createElement('div');
     toast.className = `toast ${type}`;
     toast.textContent = message;
     document.body.appendChild(toast);
     
     setTimeout(() => {
       toast.style.animation = 'slideOutRight 0.3s ease-out';
       setTimeout(() => toast.remove(), 300);
     }, 3000);
   }

   async function onConfigChange(config) {
     const customFont = config.font_family || defaultConfig.font_family;
     const baseSize = config.font_size || defaultConfig.font_size;
     const baseFontStack = 'PingFang TC, sans-serif';
     
     document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
     document.body.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color} 0%, #764ba2 100%)`;
     
     document.getElementById('main-title').textContent = config.main_title || defaultConfig.main_title;
     document.getElementById('main-title').style.fontSize = `${baseSize * 1.875}px`;
     document.getElementById('main-title').style.color = config.surface_color || defaultConfig.surface_color;
     
     document.getElementById('subtitle').textContent = config.subtitle || defaultConfig.subtitle;
     document.getElementById('subtitle').style.fontSize = `${baseSize * 1.25}px`;
     
     document.getElementById('shuffle-btn-text').textContent = config.shuffle_button_text || defaultConfig.shuffle_button_text;
     document.getElementById('reset-btn-text').textContent = config.reset_button_text || defaultConfig.reset_button_text;
     
     const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
     const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
     
     document.getElementById('shuffle-btn').style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${primaryColor}dd 100%)`;
     document.getElementById('reset-btn').style.background = `linear-gradient(135deg, ${secondaryColor} 0%, ${secondaryColor}dd 100%)`;
     
     document.querySelectorAll('.control-panel, .classes-grid, .history-section').forEach(el => {
       el.style.background = config.surface_color || defaultConfig.surface_color;
     });
     
     document.querySelectorAll('.grid-header h2, .history-header h3, .class-number').forEach(el => {
       el.style.color = config.text_color || defaultConfig.text_color;
     });
   }

   async function init() {
     updateClasses();
     renderClassGrid();
     
     document.getElementById('grade-select').addEventListener('change', (e) => {
       currentGrade = parseInt(e.target.value);
       updateClasses();
       renderClassGrid();
     });
     
     document.getElementById('class-count').addEventListener('change', (e) => {
       let value = parseInt(e.target.value);
       if (value < 1) value = 1;
       if (value > 20) value = 20;
       e.target.value = value;
       currentClassCount = value;
       updateClasses();
       renderClassGrid();
     });
     
     document.getElementById('shuffle-btn').onclick = handleShuffle;
     document.getElementById('reset-btn').onclick = handleReset;
     
     // --- ä¿®æ”¹ï¼šå¾ localStorage è®€å–ç´€éŒ„ ---
     const savedData = localStorage.getItem('shuffleHistory');
     if (savedData) {
       allRecords = JSON.parse(savedData);
     } else {
       allRecords = [];
     }
     renderHistory(allRecords); // ç«‹å³æ¸²æŸ“æ­·å²ç´€éŒ„
     
     // --- ä¿®æ”¹ï¼šæª¢æŸ¥ elementSdk æ˜¯å¦å­˜åœ¨ ---
     if (window.elementSdk) {
       // ä»åœ¨ Canva ç’°å¢ƒä¸­ï¼ŒåŸ·è¡Œ Canva ç›¸é—œç¨‹å¼ç¢¼
       window.elementSdk.init({
         defaultConfig,
         onConfigChange,
         mapToCapabilities: (config) => ({
           recolorables: [
             {
               get: () => config.background_color || defaultConfig.background_color,
               set: (value) => {
                 config.background_color = value;
                 window.elementSdk.setConfig({ background_color: value });
               }
             },
             {
               get: () => config.surface_color || defaultConfig.surface_color,
               set: (value) => {
                 config.surface_color = value;
                 window.elementSdk.setConfig({ surface_color: value });
               }
             },
             {
               get: () => config.text_color || defaultConfig.text_color,
               set: (value) => {
                 config.text_color = value;
                 window.elementSdk.setConfig({ text_color: value });
               }
             },
             {
               get: () => config.primary_action_color || defaultConfig.primary_action_color,
               set: (value) => {
                 config.primary_action_color = value;
                 window.elementSdk.setConfig({ primary_action_color: value });
               }
             },
             {
               get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
               set: (value) => {
                 config.secondary_action_color = value;
                 window.elementSdk.setConfig({ secondary_action_color: value });
               }
             }
           ],
           borderables: [],
           fontEditable: {
             get: () => config.font_family || defaultConfig.font_family,
             set: (value) => {
               config.font_family = value;
               window.elementSdk.setConfig({ font_family: value });
             }
           },
           fontSizeable: {
             get: () => config.font_size || defaultConfig.font_size,
             set: (value) => {
               config.font_size = value;
               window.elementSdk.setConfig({ font_size: value });
             }
           }
         }),
         mapToEditPanelValues: (config) => new Map([
           ['main_title', config.main_title || defaultConfig.main_title],
           ['subtitle', config.subtitle || defaultConfig.subtitle],
           ['shuffle_button_text', config.shuffle_button_text || defaultConfig.shuffle_button_text],
           ['reset_button_text', config.reset_button_text || defaultConfig.reset_button_text]
         ])
       });
     } else {
       // ä¸åœ¨ Canva ç’°å¢ƒ (ä¾‹å¦‚ GitHub Pages)ï¼Œæ‰‹å‹•å¥—ç”¨é è¨­æ¨£å¼
       onConfigChange(defaultConfig);
     }
   }

   init();
 </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99d3a6dd171d4a86',t:'MTc2MjkyNTU3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>
